<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Mapfish Appserver by pka</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Mapfish Appserver</h1>
        <h2>Mapfish Appserver is a framework for web mapping applications using OGC standards and the Mapfish protocol</h2>
        <a href="https://github.com/pka/gb_mapfish_appserver" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="mapfish-appserver" class="anchor" href="#mapfish-appserver"><span class="octicon octicon-link"></span></a>Mapfish Appserver</h1>

<p>Mapfish Appserver is a platform for building web mapping applications using OGC standards and the Mapfish REST protocol.</p>

<h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h2>

<p>Mapfish Appserver comes with the following out-of-the box features:</p>

<ul>
<li>Organize maps by topics, categories, organisational units, keywords and more</li>
<li>Combine maps with background and overlay topics with adjustable opacity</li>
<li>Import UMN Mapserver mapfiles to publish new topics within seconds</li>
<li>Fully customizable legends and feature infos</li>
<li>Creation of complex custom searches</li>
<li>Rich digitizing and editing functionality</li>
<li>Role-based access control on topic, layer and attribute level</li>
<li>Access control for WMS and WFS</li>
<li>Rich library of ExtJS 4 based map components</li>
<li>Multiple customizable viewers from minimal mobile viewer to full featured portal</li>
<li>Multi-site support</li>
<li>Built-in administration backend</li>
<li>Self-organized user groups</li>
</ul><h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>To build a new Mapfish Appserver application, create a Rails application and include mapfish_appserver in your Gemfile::</p>

<p>rails new mfdemo --database=postgresql --skip-bundle --skip-javascript
  cd mfdemo
  echo "gem 'therubyracer', :platforms =&gt; :ruby" &gt;&gt;Gemfile
  echo "gem 'gb_mapfish_appserver'" &gt;&gt;Gemfile
  echo "gem 'gb_mapfish_print'" &gt;&gt;Gemfile
  echo "gem 'ruby_mapscript', :platforms =&gt; :ruby" &gt;&gt;Gemfile
  bundle install</p>

<p>Also make sure, you have MapScript installed::</p>

<p>sudo apt-get install ruby-mapscript1.9.1</p>

<p>Setup the Mapfish project, initialize the application database::</p>

<p>rake db:create
  rails generate mapfish:install --default-site-name=maps.example.com</p>

<p>Keep the admin password for later.</p>

<p>Generate a basic viewer::</p>

<p>rake mapfish:viewer:create name=myviewer repo=<a href="https://github.com/pka/gb_gis_browser_viewer.git">https://github.com/pka/gb_gis_browser_viewer.git</a>
  rm public/index.html</p>

<p>Add a default route to your viewer in config/routes.rb::</p>

<p>root :to =&gt; "apps#show", :app =&gt; "myviewer"</p>

<p>Setup a PostGIS database and load some data::</p>

<p>export PGPORT=5432
  createdb geodb
  psql -d geodb -c "CREATE EXTENSION postgis"
  psql -d geodb -c "GRANT ALL ON geometry_columns TO PUBLIC; GRANT ALL ON geography_columns TO PUBLIC; GRANT ALL ON spatial_ref_sys TO PUBLIC"
  wget <a href="http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_0_countries_lakes.zip">http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/cultural/ne_10m_admin_0_countries_lakes.zip</a>
  unzip ne_10m_admin_0_countries_lakes.zip
  ogr2ogr -f PostgreSQL PG:"dbname=geodb" -nln countries -nlt MULTIPOLYGON ne_10m_admin_0_countries_lakes.shp</p>

<p>Create a mapfile naturalearth.map in the directory mapconfig/maps.example.com::</p>

<pre><code>MAP
  NAME naturalearth

  WEB
    METADATA
      "wms_title"                  "Natural Earth"
      "wms_onlineresource"         "http://wms.example.com/naturalearth"
      "wms_srs"                    "EPSG:4326 EPSG:3857"
      "wms_extent"                 "-180 -90 180 90"
      "wms_feature_info_mime_type" "application/vnd.ogc.gml"
      'ows_enable_request'    '*'
      "wms_encoding"               "UTF-8"
    END
    IMAGEPATH '/tmp/'
    IMAGEURL '/tmp/'
  END

  SIZE 512 512
  MAXSIZE 8192
  RESOLUTION 96
  DEFRESOLUTION 96

  UNITS DD
  PROJECTION
    "init=epsg:4326"
  END

  EXTENT -180 -90 180 90

  IMAGECOLOR 255 255 255

  #SYMBOLSET "../symbols/base.sym"
  #FONTSET   "../fonts/fonts.txt"

  IMAGETYPE png

  OUTPUTFORMAT
    NAME png
    DRIVER "AGG/PNG"
    IMAGEMODE rgb
    FORMATOPTION "INTERLACE=OFF"
  END

  LAYER
    NAME 'countries'
    METADATA
      "wms_title"                       "Countries"
      "wms_srs"                         "EPSG:4326"
      "wms_extent"                      "-180 -90 180 90"
      "wms_include_items"               "name,pop_est"
      "gml_include_items"               "name,pop_est"
      "gml_name_alias"                  "Name"
      "gml_pop_est_alias"               "Population"
    END

    EXTENT -180 -90 180 90
    #MINSCALEDENOM 1
    #MAXSCALEDENOM 500000.5

    STATUS ON
    TYPE POLYGON
    CONNECTIONTYPE postgis
    CONNECTION "dbname=mfdemo port=5432"
    DATA "geom FROM countries"

    CLASS
      NAME 'All countries'
      STYLE
        WIDTH 0.91 
        OUTLINECOLOR 0 0 0
        COLOR 0 255 0
      END
    END
  END

END
</code></pre>

<p>Check your WMS setup::</p>

<p>#sudo apt-get install cgi-mapserver
  wget -O map.png "http://localhost/cgi-bin/mapserv?map=$(pwd)/mapconfig/maps.example.com/naturalearth.map&amp;SERVICE=WMS&amp;VERSION=1.3.0&amp;REQUEST=GetMap&amp;BBOX=-90,-180,90,180&amp;CRS=EPSG:4326&amp;WIDTH=706&amp;HEIGHT=354&amp;LAYERS=countries&amp;STYLES=&amp;FORMAT=image/png"</p>

<p>Open <code>config/initializers/mapfish.rb</code> to configure your application.</p>

<p>Import the mapfile into a new topic::</p>

<p>rake mapfile:import_topic MAPFILE=mapconfig/maps.example.com/naturalearth.map SITE=maps.example.com</p>

<p>Start the application server and open your first viewer application in your web browser::</p>

<p>rails server
  x-www-browser localhost:3000/</p>

<p>To access the backend::</p>

<p>x-www-browser localhost:3000/gbadmin</p>

<p>Login as 'admin' with with the generated password. After your first login you will be redirected back to the root path.
Go to http://localhost:3000/gbadmin/user/1/edit to change the password.</p>

<h2>
<a name="documentation" class="anchor" href="#documentation"><span class="octicon octicon-link"></span></a>Documentation</h2>

<p>For more documentation see the <code>Github wiki &lt;https://github.com/sourcepole/mapfish_appserver/wiki&gt;</code>_</p>

<h2>
<a name="authors-and-license" class="anchor" href="#authors-and-license"><span class="octicon octicon-link"></span></a>Authors and License</h2>

<p>Primary authors are Pirmin Kalberer and Matthias Walker, Sourcepole, Stefan Zinggeler and Adrian Herzog, Canton of Zurich.</p>

<p>New BSD License</p>

<p><em>Copyright (c) 2009-2013 Sourcepole AG &amp; Canton of Zurich</em></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/pka/gb_mapfish_appserver/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/pka/gb_mapfish_appserver/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/pka/gb_mapfish_appserver"></a> is maintained by <a href="https://github.com/pka">pka</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>